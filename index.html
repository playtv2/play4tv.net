<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>HOT play</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>
    <style>
        :root { --red: #ff0055; --bg: #000000; --sidebar-width: 70px; --sidebar-expanded: 220px; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden; display: flex; }
        *:focus { outline: none; }

        .sidebar { width: var(--sidebar-width); background: #000; display: flex; flex-direction: column; padding: 15px 5px; border-left: 1px solid #222; height: 100%; z-index: 1000; transition: width 0.3s ease; overflow: hidden; white-space: nowrap; flex-shrink: 0; }
        .sidebar:focus-within, .sidebar:hover { width: var(--sidebar-expanded); }
        .logo { width: 100%; height: 60px; background: url('./images/logo.png') no-repeat center/contain; margin: 20px 0; }
        .nav-item { padding: 12px; font-size: 16px; border-radius: 8px; margin-bottom: 5px; cursor: pointer; display: flex; align-items: center; color: #888; transition: 0.2s; }
        .nav-item:focus { background: var(--red); color: white; transform: scale(1.05); }
        .nav-icon { font-size: 22px; min-width: 40px; text-align: center; }
        .nav-text { opacity: 0; visibility: hidden; transition: 0.2s; margin-right: 10px; font-weight: 600; }
        .sidebar:focus-within .nav-text, .sidebar:hover .nav-text { opacity: 1; visibility: visible; }

        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; background: #000; overflow: hidden; }
        .top-section { height: 55%; width: 100%; position: relative; flex-shrink: 0; }
        .hero-bg { position: absolute; inset: 0; background-size: cover; background-position: top center; transition: 0.4s; }
        .hero-bg::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, #000 5%, rgba(0,0,0,0.6) 50%, transparent 100%); }
        .hero-text { position: absolute; bottom: 20px; right: 50px; z-index: 2; }
        .hero-title { font-size: 60px; font-weight: 800; text-shadow: 2px 2px 15px black; margin: 0; }
        .hero-desc { font-size: 20px; color: #ddd; max-width: 60%; margin-top: 10px; }

        .bottom-section { height: 45%; flex-grow: 1; overflow-y: auto; overflow-x: hidden; padding-bottom: 100px; padding-top: 10px; scroll-behavior: smooth; }
        .bottom-section::-webkit-scrollbar { display: none; }
        .category-block { margin-bottom: 5px; display: block; }
        .category-title { font-size: 18px; margin-right: 35px; font-weight: bold; color: #aaa; }

        .row { display: flex; gap: 15px; padding: 40px 0 40px 0; margin-top: -30px; overflow-x: auto; scroll-behavior: smooth; scroll-snap-type: x mandatory; padding-left: 50px; }
        .row::-webkit-scrollbar { display: none; }

        .card { display: inline-block; position: relative; cursor: pointer; border-radius: 6px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.5); border: 2px solid transparent; transition: transform 0.2s, border-color 0.2s; flex-shrink: 0; z-index: 1; scroll-snap-align: start; transform-origin: center center; }
        .row .card:first-child { transform-origin: right center !important; margin-right: 2px; }
        .row .card:last-child { transform-origin: left center !important; }

        .card.series { min-width: 200px; width: 200px; height: 112px; }
        .card.movie { min-width: 100px; width: 100px; height: 150px; }
        .card img { width: 100%; height: 100%; object-fit: cover; object-position: top center; }
        .card:focus { transform: scale(1.15); z-index: 100; border-color: #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.9); outline: none; }
        .card-title-overlay { position: absolute; bottom: 0; inset-inline: 0; background: rgba(0,0,0,0.8); padding: 5px; text-align: center; font-size: 11px; opacity: 0; transition: 0.2s; }
        .card:focus .card-title-overlay { opacity: 1; }

        #video-container { position: fixed; inset: 0; background: #000; z-index: 50000; display: none; }
        .screen { display: none; position: fixed; inset: 0; background: #000; z-index: 20000; align-items: center; justify-content: center; }
        #auth-screen { flex-direction: column; z-index: 10000; }
        #content-view { display: none; padding: 30px; position: absolute; inset: 0; z-index: 20; background: #000; overflow-y: auto; }
        .search-input { width: 600px; background: #222; border: 2px solid #333; color: white; padding: 15px; border-radius: 50px; font-size: 20px; }
        .search-input:focus { border-color: var(--red); }
    </style>
</head>
<body>
    <div id="loading-screen" class="screen" style="display: flex;"><h1>×˜×•×¢×Ÿ...</h1></div>
    <div id="auth-screen" class="screen">
        <h1 style="color:var(--red); font-size:60px">HOT Play</h1>
        <button class="nav-item" onclick="login()" style="background:var(--red); color:white; justify-content:center; width:200px;">×”×ª×—×‘×¨×•×ª</button>
    </div>
    <div id="profile-screen" class="screen" style="flex-direction:column"><h1 style="margin-bottom:30px">××™ ×¦×•×¤×”?</h1><div id="profile-list" style="display:flex; gap:20px"></div></div>
    
    <div class="sidebar screen" id="sidebar">
        <div class="logo"></div><div id="dynamic-nav"></div>
    </div>
    
    <div class="main-content screen" id="app">
        <div class="top-section">
            <div id="hero-bg" class="hero-bg"></div>
            <div class="hero-text"><div id="hero-title" class="hero-title"></div><div id="hero-desc" class="hero-desc"></div></div>
        </div>
        <div class="bottom-section" id="home-view"></div>
        <div id="content-view"></div>
    </div>
    
    <div id="video-container"></div>

    <script src="data.js"></script>
    <script>
        setTimeout(() => { 
            const loader = document.getElementById('loading-screen');
            if(loader) loader.style.display='none'; 
        }, 3000);

        try {
            const firebaseConfig = { apiKey: "AIzaSyAuJlFyTuYypCVdJrZCrQGOEZZS5WDH6pI", authDomain: "app-c71dd.firebaseapp.com", projectId: "app-c71dd", storageBucket: "app-c71dd.firebasestorage.app", messagingSenderId: "256556501971", appId: "1:256556501971:web:98dbba775b0b8ca913bd26" };
            firebase.initializeApp(firebaseConfig);
            
            firebase.auth().onAuthStateChanged(u => { 
                document.getElementById('loading-screen').style.display='none';
                if(u && u.email === "nitaylayish298@gmail.com") { switchScreen('profiles'); loadProfiles(); } 
                else { switchScreen('auth'); } 
            });
        } catch(e) {
            console.error(e);
            document.getElementById('loading-screen').style.display='none';
            switchScreen('auth');
        }

        let currentProfile = null;
        let lastFocusedId = null;
        let currentPlayingId = null; 

        const profilesData = [
            { n: '× ×™×ª××™', i: 'https://img.freepik.com/free-psd/3d-illustration-person-with-sunglasses_23-2149436188.jpg', type: 'kids' },
            { n: '××‘×', i: 'https://img.freepik.com/free-psd/3d-illustration-business-man-with-glasses_23-2149436194.jpg', type: 'adults' },
            { n: '××™××•×©', i: 'https://img.freepik.com/free-psd/3d-illustration-person-with-long-hair_23-2149436197.jpg', type: 'adults' },
            { n: '× ×•×¢×”', i: 'https://img.freepik.com/free-psd/3d-illustration-person-with-pink-hair_23-2149436186.jpg', type: 'kids' },
            { n: '××•×¨×™', i: 'https://img.freepik.com/free-psd/3d-illustration-person-with-glasses_23-2149436185.jpg', type: 'kids' }
        ];

        function loadProfiles() {
            document.getElementById('profile-list').innerHTML = profilesData.map(p => `
                <div class="profile-box" tabindex="0" onclick="selectProfile('${p.n}')" style="text-align:center; cursor:pointer">
                    <div style="width:100px; height:100px; border-radius:50%; background:url('${p.i}') center/cover; border:3px solid transparent; margin-bottom:10px" class="p-img"></div>
                    <span>${p.n}</span>
                </div>`).join('');
            setTimeout(()=> document.querySelector('.profile-box').focus(), 500);
        }

        function selectProfile(n) { currentProfile = profilesData.find(p=>p.n===n); updateSidebar(); switchScreen('home'); renderHome(); }
        function updateSidebar() {
            document.getElementById('dynamic-nav').innerHTML = `
                <div class="nav-item" tabindex="0" onclick="showSearch()"><span class="nav-icon">ğŸ”</span><span class="nav-text">×—×™×¤×•×©</span></div>
                <div class="nav-item" tabindex="0" onclick="renderHome()"><span class="nav-icon">ğŸ </span><span class="nav-text">×¨××©×™</span></div>
                <div class="nav-item" tabindex="0" style="margin-top:auto" onclick="switchScreen('profiles')"><span class="nav-icon">ğŸ”„</span><span class="nav-text">×¤×¨×•×¤×™×œ</span></div>`;
        }

        function renderHome() {
            const h = document.getElementById('home-view'); h.innerHTML=''; document.querySelector('.top-section').style.display='block';
            const hist = JSON.parse(localStorage.getItem(`history_${currentProfile.n}`)||"[]");
            if(hist.length) h.innerHTML += renderRow("×”××©×š ×¦×¤×™×™×”", hist, true);
            
            const cats = currentProfile.type==='kids'?['×™×œ×“×™×']:['×¡×“×¨×•×ª','×¡×¨×˜×™×'];
            const items = seriesData.filter(s=>cats.includes(s.category));
            [...new Set(items.map(s=>s.genre||s.category))].forEach(g => {
                const rowItems = items.filter(s=>(s.genre||s.category)===g);
                if(rowItems.length) h.innerHTML += renderRow(g, rowItems);
            });
            if(lastFocusedId) setTimeout(()=>{const e=document.querySelector(`[data-id="${lastFocusedId}"]`); if(e){e.focus(); e.scrollIntoView({block:'center'})}},100);
        }

        function renderRow(t, items, force) {
            const mixed = items.some(i=>i.type==='series'||i.category==='×¡×“×¨×•×ª');
            const cards = items.map(s => {
                let cls = (force||mixed) ? 'series' : (s.type==='movie'?'movie':'series');
                return `<div class="card ${cls}" tabindex="0" data-id="${s.id}" onclick="openContent('${s.id}')">
                    <img src="${s.image}"><div class="card-title-overlay">${s.title}</div></div>`;
            }).join('');
            return `<div class="category-block"><div class="category-title">${t}</div><div class="row">${cards}</div></div>`;
        }

        function openContent(id) {
            let s = seriesData.find(x=>x.id===id) || JSON.parse(localStorage.getItem(`history_${currentProfile.n}`)).find(x=>x.id===id);
            if(!s) return;
            lastFocusedId=id; addToHistory(s);
            const v = document.getElementById('content-view');
            document.querySelector('.top-section').style.display='none'; document.querySelector('.bottom-section').style.display='none';
            v.style.display='block';
            
            if(s.type==='movie') {
                v.innerHTML = `<div style="height:100vh; padding:60px; display:flex; flex-direction:column; justify-content:center; background:linear-gradient(to right, #000, transparent), url('${s.image}') center/cover;">
                    <h1>${s.title}</h1><p style="max-width:600px">${s.description}</p>
                    <button class="nav-item" style="background:var(--red); color:white; width:200px; justify-content:center" onclick="playHD('${s.driveId}')">â–¶ × ×’×Ÿ</button></div>`;
            } else {
                v.innerHTML = `<div style="padding:40px"><h1>${s.title}</h1><p>${s.description}</p>
                    <div class="row">${s.episodes.map(e=>`<div class="card series" tabindex="0" data-id="${e.driveId}" onclick="playHD('${e.driveId}')"><img src="${e.image||s.image}"><div class="card-title-overlay">×¤×¨×§ ${e.number}</div></div>`).join('')}</div></div>`;
            }
            setTimeout(()=>v.querySelector('[tabindex="0"]').focus(),100);
        }

        function playHD(id) {
            currentPlayingId = id;
            if (typeof AndroidControl !== 'undefined') AndroidControl.setVideoMode(true);
            const c = document.getElementById('video-container');
            c.style.display='block';
            c.innerHTML = `<iframe src="https://drive.google.com/file/d/${id}/preview" allowfullscreen style="width:100%; height:100%; border:none"></iframe>`;
        }

        // --- ×”×ª×™×§×•×Ÿ ×”×§×¨×™×˜×™: ××™×¤×•×¡ ××©×ª× ×” ×”× ×™×’×•×Ÿ ---
        window.handleBackPress = function() {
            if(document.getElementById('video-container').style.display === 'block') {
                document.getElementById('video-container').innerHTML = '';
                document.getElementById('video-container').style.display = 'none';
                
                // >>> ×”× ×” ×”×©×•×¨×” ×©×ª×¡×“×¨ ××ª ×”×‘×¢×™×”: ×××¤×¡×™× ××ª ×”"×‘×•×¦×¢" <<<
                window.hpDone = false; 
                
                document.getElementById('content-view').style.display = 'block';
                if(currentPlayingId) setTimeout(()=>{ 
                    const e = document.querySelector(`[data-id="${currentPlayingId}"]`);
                    if(e) { e.focus(); e.scrollIntoView({block:'center', inline:'center'}); }
                }, 50);
                
                if (typeof AndroidControl !== 'undefined') AndroidControl.setVideoMode(false);
                return;
            }
            if(document.getElementById('content-view').style.display === 'block') {
                document.getElementById('content-view').style.display = 'none';
                switchScreen('home'); renderHome(); return;
            }
            if(document.getElementById('search-input')) { enterApp(); return; }
            if(document.querySelector('.bottom-section').style.display === 'block') { switchScreen('profiles'); return; }
            
            if (window.AndroidControl) AndroidControl.exitApp();
        };

        function addToHistory(item) {
            if(!currentProfile) return;
            const k = `history_${currentProfile.n}`;
            let h = JSON.parse(localStorage.getItem(k)||"[]").filter(x=>x.id!==item.id);
            h.unshift(item); localStorage.setItem(k, JSON.stringify(h.slice(0,10)));
        }

        function switchScreen(n) {
            document.querySelectorAll('.screen, #content-view, #video-container').forEach(e=>e.style.display='none');
            if(n==='auth') document.getElementById('auth-screen').style.display='flex';
            if(n==='profiles') document.getElementById('profile-screen').style.display='flex';
            if(n==='home') {
                document.getElementById('sidebar').style.display='flex';
                document.getElementById('app').style.display='flex';
                document.querySelector('.top-section').style.display='block';
                document.querySelector('.bottom-section').style.display='block';
                setTimeout(() => { const c=document.querySelector('.card'); if(c)c.focus(); }, 500);
            }
        }

        function enterApp() { switchScreen('home'); renderHome(); }
        function login() { firebase.auth().signInWithRedirect(new firebase.auth.GoogleAuthProvider()); }
        
        window.addEventListener('keydown', e => {
            const active = document.activeElement;
            if(active.classList.contains('nav-item') && e.key === 'ArrowLeft') {
                if(lastFocusedId) { const el=document.querySelector(`[data-id="${lastFocusedId}"]`); if(el) el.focus(); else document.querySelector('.card').focus(); }
                else document.querySelector('.card').focus();
            }
            if(active.id === 'search-input' && e.key === 'ArrowDown') {
                e.preventDefault();
                const f = document.querySelector('.card'); if(f) f.focus();
            }
        });
        
        function showSearch() {
            document.getElementById('home-view').innerHTML = `<div class="search-container"><input type="text" id="search-input" class="search-input" placeholder="×—×¤×©..." oninput="runSearch(this.value)"><div id="search-results"></div></div>`;
            document.querySelector('.top-section').style.display='none';
            setTimeout(()=>document.getElementById('search-input').focus(),100);
        }
        
        function runSearch(q) {
            if(q.length<2) { document.getElementById('search-results').innerHTML=''; return; }
            const cats = currentProfile.type==='kids'?['×™×œ×“×™×']:['×¡×“×¨×•×ª','×¡×¨×˜×™×'];
            const res = seriesData.filter(s=>cats.includes(s.category) && s.title.includes(q));
            document.getElementById('search-results').innerHTML = res.length ? renderRow("×ª×•×¦××•×ª", res) : "×œ× × ××¦×";
        }

        document.addEventListener('focus', e => {
            if(e.target.classList.contains('card') && document.querySelector('.top-section').style.display!=='none') {
                const id = e.target.dataset.id;
                const s = seriesData.find(x=>x.id===id) || seriesData.find(x=>x.episodes && x.episodes.some(ep=>ep.driveId===id));
                if(s) {
                    document.getElementById('hero-bg').style.backgroundImage = `url('${s.image}')`;
                    document.getElementById('hero-title').innerText = s.title;
                    document.getElementById('hero-desc').innerText = s.description;
                }
            }
        }, true);
    </script>
</body>
</html>
